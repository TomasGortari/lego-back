"use strict";var e=(e,i)=>{const{InvalidPayloadException:a,ItemsService:n,MetaService:r}=i.services;e.get("/",(async(e,r,t)=>{var o,d,s,l,c,u,m;if(!e.body)return t(new a("Please provide a body"));const v={name:(null===(o=e.query)||void 0===o?void 0:o.name)||"",minPrice:Number(null===(d=e.query)||void 0===d?void 0:d.minPrice)||0,maxPrice:Number(null===(s=e.query)||void 0===s?void 0:s.maxPrice)||1e8,tags:(null===(c=null===(l=e.query)||void 0===l?void 0:l.tags)||void 0===c?void 0:c.map((e=>Number(e))))||[],fields:(null===(u=e.query)||void 0===u?void 0:u.fields)||["*.*.*"]},y=new n("announcement",{schema:e.schema,accountability:e.accountability,knex:i.database}),_=await y.readByQuery({fields:v.fields,filter:{_and:null===(m=null==v?void 0:v.tags)||void 0===m?void 0:m.map((e=>({tags:{tags_id:{_eq:e}}}))),price:{_between:[v.minPrice,v.maxPrice]},_or:[{name:{_icontains:v.name}},{user:{first_name:{_icontains:v.name}}},{user:{last_name:{_icontains:v.name}}},{user:{email:{_icontains:v.name}}}]}}).then((e=>e)).catch((e=>{i.logger.error({msg:"[SEARCH][READ_BY_QUERY]",err:e})}));return(null==_?void 0:_.length)?r.send({data:_}):r.send({data:[]})}))};module.exports=e;
